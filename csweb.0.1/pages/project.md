![test case gif](images/full-test-suite.gif "images/full-test-suite.gif")

Augmented Reality (AR) systems are widely expected to become a significant platform for software development in the near future, but effectively testing that software on those systems is challenging, both because of the size of the potential input set and the difficulty of controlling conditions under repeated tests. Previous research explored using virtual reality (VR) as a theoretical solution to evaluating AR usability under controlled conditions where aspects of a simulated AR application (registration and jitter) could be experimentally controlled. By surveying a subset of available AR application platforms to determine their capabilities, I identified one (Android) which was capable of supporting the use of 3D VR test fixtures in testing AR applications, demonstrating the validity of this approach for testing non-simulated AR applications. A trivial Android ARCore application was written, and the ability of these tests to identify and kill mutants are used to validate this approach. In addition, AR platform requirements for generalizing and improving the use of VR fixtures for automated testing of AR software are proposed. Adopting the proposed requirements to support automated testing is suggested as a necessary factor to foster the development of high-quality, reliable AR software ecosystems.

# Initial Criteria

Based on widespread commercial and open-source software testing practices, the search for appropriate AR SDKs began with the following requirements against which candidate systems were evaluated:

* Application and test source must, as much as possible, be stored in plain text in order to maintain ease-of-use with common version control systems and software development workflows.
* Builds and tests should be triggered via a command-line interface, rather than taking an action in a GUI, in order to maintain ease-of-use with common continuous integration (CI) environments.
* The fixture should always start in the same ground state even if it is used in multiple tests during the same test run.
* It should be possible to install, configure, and cache the test environment without manual interventions.
* It should be possible both to change the state of the application's environment and access information about application state from within executable test code.
* Pass/fail information should be returned to the same command-line interface used to start builds and tests, ideally with an exit code that can be used to automatically determine whether or not all tests have passed.

# Methodology

Several different AR platforms/SDKs were evaluated until a suitable one, Google's Android, was identified as supporting the initial criteria. If an Android Virtual Device (AVD) is [configured](https://developers.google.com/ar/develop/java/emulator#create_a_virtual_device_with_ar_support) with the appropriate settings to enable ARCore, the emulated hardaware – including the camera and the accelerometer – will be fed appropriate data as if the device is "in" a 3D environment. A small apartment (constructed with files sharing the prefix "Toren1BD") serves as the environment.

![Toren1BD VR apartment](images/vr-room.jpg "images/vr-room.jpg")

Then, a trivial AR application, a simplified navigation aid for the visually impaired, was developed. This application conducts hit tests using Google's ARCore framework to determine the distance of the first object encountered by an imaginary vector passing from the middle of the device to infinity, perpendicular to the device's major axis. It enters four different states depending on the distance of that object:

* Not close to anything (more than 5 meters from an object)
* Avoid the obstacle in N meters (where N is between 5 and 3 meters)
* Close (where the distance is between 1 and 3 meters )
* Stop! (where the object is less than 1 meter away)

![AR Test Application in VR Room](images/ar-application-in-vr-room.jpg "images/ar-application-in-vr-room.jpg")

Although not well-documented, there exists a facility for recording and re-playing movements in the 3D environment. Additionally, the emulated device is created with a special IP address (10.0.2.2) through which the emulator running the device can be sent commands. A handful of helper commands were developed to be used by tests, such that specific tests can trigger specific navigations in the 3D environment. Then, during test runs, each test triggers a pre-recorded navigation macro, and when it is complete, the state of the application is checked.

# Results

For the core application logic (i.e. not the ARCore-related boilerplate) 100% test coverage was achieved, and 94.1% of mutations generated by PIT were killed by the tests. Although it would be theoretically possible to dynamically generate the necessary scenes, frames, and objects for individual hit tests, to achieve similar results, this would quickly become infesible for more complicated applications, or applications which required tests of continuous navigation.

# Video

## Complete test suite running
This video shows the complete test suite running tests of the AR application in VR

[![Test suite](http://img.youtube.com/vi/CrEyT2qHp_I/0.jpg)](https://youtu.be/CrEyT2qHp_I)

## Demo video
This three-minute video covers the project.

[![Demo video](http://img.youtube.com/vi/743jUWf_svQ/0.jpg)](https://youtu.be/743jUWf_svQ)

